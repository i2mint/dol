<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dol.sources &mdash; dol 0.2.65 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=30a7333d"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
        <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="dol.tests.base_test" href="tests/base_test.html" />
    <link rel="prev" title="dol.signatures" href="signatures.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            dol
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../dol.html">dol</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendable.html">dol.appendable</a></li>
<li class="toctree-l1"><a class="reference internal" href="base.html">dol.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">dol.caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="dig.html">dol.dig</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">dol.errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="explicit.html">dol.explicit</a></li>
<li class="toctree-l1"><a class="reference internal" href="filesys.html">dol.filesys</a></li>
<li class="toctree-l1"><a class="reference internal" href="kv_codecs.html">dol.kv_codecs</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">dol.misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="mixins.html">dol.mixins</a></li>
<li class="toctree-l1"><a class="reference internal" href="naming.html">dol.naming</a></li>
<li class="toctree-l1"><a class="reference internal" href="paths.html">dol.paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">dol.recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap.html">dol.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/new_store_wrap.html">dol.scrap.new_store_wrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/store_factories.html">dol.scrap.store_factories</a></li>
<li class="toctree-l1"><a class="reference internal" href="signatures.html">dol.signatures</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">dol.sources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.AttrContainer"><code class="docutils literal notranslate"><span class="pre">AttrContainer</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.AttrDict"><code class="docutils literal notranslate"><span class="pre">AttrDict</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.Attrs"><code class="docutils literal notranslate"><span class="pre">Attrs</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dol.sources.Attrs.update"><code class="docutils literal notranslate"><span class="pre">Attrs.update()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#dol.sources.Attrs.update_keys_cache"><code class="docutils literal notranslate"><span class="pre">Attrs.update_keys_cache()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.CachedKeysSequenceKvReader"><code class="docutils literal notranslate"><span class="pre">CachedKeysSequenceKvReader</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dol.sources.CachedKeysSequenceKvReader.update"><code class="docutils literal notranslate"><span class="pre">CachedKeysSequenceKvReader.update()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#dol.sources.CachedKeysSequenceKvReader.update_keys_cache"><code class="docutils literal notranslate"><span class="pre">CachedKeysSequenceKvReader.update_keys_cache()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.CachedSequenceKvReader"><code class="docutils literal notranslate"><span class="pre">CachedSequenceKvReader</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.Ddir"><code class="docutils literal notranslate"><span class="pre">Ddir</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.FanoutPersister"><code class="docutils literal notranslate"><span class="pre">FanoutPersister</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.FanoutReader"><code class="docutils literal notranslate"><span class="pre">FanoutReader</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dol.sources.FanoutReader.from_variadics"><code class="docutils literal notranslate"><span class="pre">FanoutReader.from_variadics()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.FlatReader"><code class="docutils literal notranslate"><span class="pre">FlatReader</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.FuncDag"><code class="docutils literal notranslate"><span class="pre">FuncDag</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.FuncReader"><code class="docutils literal notranslate"><span class="pre">FuncReader</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.NotUnique"><code class="docutils literal notranslate"><span class="pre">NotUnique</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.ObjReader"><code class="docutils literal notranslate"><span class="pre">ObjReader</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.sources.SequenceKvReader"><code class="docutils literal notranslate"><span class="pre">SequenceKvReader</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tests/base_test.html">dol.tests.base_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/pickability_test.html">dol.tests.pickability_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/scrap.html">dol.tests.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_appendable.html">dol.tests.test_appendable</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_dol_tools.html">dol.tests.test_dol_tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_edge_cases.html">dol.tests.test_edge_cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_fanout_stores.html">dol.tests.test_fanout_stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_filesys.html">dol.tests.test_filesys</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_kv_codecs.html">dol.tests.test_kv_codecs</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_paths.html">dol.tests.test_paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_trans.html">dol.tests.test_trans</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/utils_for_tests.html">dol.tests.utils_for_tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">dol.tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="trans.html">dol.trans</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">dol.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="zipfiledol.html">dol.zipfiledol</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dol</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">dol.sources</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/module_docs/dol/sources.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-dol.sources">
<span id="dol-sources"></span><h1>dol.sources<a class="headerlink" href="#module-dol.sources" title="Link to this heading"></a></h1>
<p>This module contains key-value views of disparate sources.</p>
<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.AttrContainer">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">AttrContainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">*objects,</span> <span class="pre">_object_namer:</span> <span class="pre">~typing.Callable[[~typing.Any],</span> <span class="pre">str]</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">_dflt_object_namer&gt;,</span> <span class="pre">**named_objects</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#AttrContainer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.AttrContainer" title="Link to this definition"></a></dt>
<dd><p>Convenience class to hold Key-Val pairs as attribute-val pairs, with all the
magic methods of mappings.</p>
<p>On the other hand, you will not get the usuall non-dunders (non magic methods) of
<code class="docutils literal notranslate"><span class="pre">Mappings</span></code>. This is so that you can use tab completion to access only the keys
the container has, and not any of the non-dunder methods like <code class="docutils literal notranslate"><span class="pre">get</span></code>, <code class="docutils literal notranslate"><span class="pre">items</span></code>,
etc.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">da</span> <span class="o">=</span> <span class="n">AttrContainer</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">life</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">foo</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;life&#39;</span><span class="p">]</span>
<span class="go">42</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">true</span> <span class="o">=</span> <span class="s1">&#39;love&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>  <span class="c1"># count the number of fields</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;forever&#39;</span>  <span class="c1"># write as dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">friends</span>  <span class="c1"># read as attribute</span>
<span class="go">&#39;forever&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>  <span class="c1"># list fields (i.e. keys i.e. attributes)</span>
<span class="go">[&#39;foo&#39;, &#39;life&#39;, &#39;true&#39;, &#39;friends&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;life&#39;</span> <span class="ow">in</span> <span class="n">da</span>  <span class="c1"># check containement</span>
<span class="go">True</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">da</span><span class="p">[</span><span class="s1">&#39;friends&#39;</span><span class="p">]</span>  <span class="c1"># delete as dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">da</span><span class="o">.</span><span class="n">foo</span> <span class="c1"># delete as attribute</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
<span class="go">[&#39;life&#39;, &#39;true&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">_source</span>  <span class="c1"># the hidden Mapping (here dict) that is wrapped</span>
<span class="go">{&#39;life&#39;: 42, &#39;true&#39;: &#39;love&#39;}</span>
</pre></div>
</div>
<p>If you don’t specify a name for some objects, <code class="docutils literal notranslate"><span class="pre">AttrContainer</span></code> will use the
<code class="docutils literal notranslate"><span class="pre">__name__</span></code> attribute of the objects:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">AttrContainer</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="s1">&#39;objects&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="go">[&#39;map&#39;, &#39;tuple&#39;, &#39;obj&#39;]</span>
</pre></div>
</div>
<p>You can also specify a different way of auto naming the objects:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">AttrContainer</span><span class="p">(</span><span class="s1">&#39;an&#39;</span><span class="p">,</span> <span class="s1">&#39;example&#39;</span><span class="p">,</span> <span class="n">_object_namer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">}</span>
<span class="go">{&#39;_2&#39;: &#39;an&#39;, &#39;_7&#39;: &#39;example&#39;}</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Objects in <code class="docutils literal notranslate"><span class="pre">py2store.utils.attr_dict</span></code> module</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.AttrDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">AttrDict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">*objects,</span> <span class="pre">_object_namer:</span> <span class="pre">~typing.Callable[[~typing.Any],</span> <span class="pre">str]</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">_dflt_object_namer&gt;,</span> <span class="pre">**named_objects</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#AttrDict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.AttrDict" title="Link to this definition"></a></dt>
<dd><p>Convenience class to hold Key-Val pairs with both a dict-like and struct-like
interface.</p>
<p>The dict-like interface has just the basic get/set/del/iter/len
(all “dunders”: none visible as methods). There is no get, update, etc.
This is on purpose, so that the only visible attributes
(those you get by tab-completion for instance) are the those you injected.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">da</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">life</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
<p>You get the “keys as attributes” that you get with <code class="docutils literal notranslate"><span class="pre">AttrContainer</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">foo</span>
<span class="go">&#39;bar&#39;</span>
</pre></div>
</div>
<p>But additionally, you get the extra <code class="docutils literal notranslate"><span class="pre">Mapping</span></code> methods:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">[&#39;foo&#39;, &#39;life&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[&#39;bar&#39;, 42]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;not_a_key&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
<span class="go">&#39;default&#39;</span>
</pre></div>
</div>
<p>You can assign through key or attribute assignment:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;love&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">da</span><span class="o">.</span><span class="n">friends</span> <span class="o">=</span> <span class="s1">&#39;forever&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="go">[(&#39;foo&#39;, &#39;bar&#39;), (&#39;life&#39;, 42), (&#39;true&#39;, &#39;love&#39;), (&#39;friends&#39;, &#39;forever&#39;)]</span>
</pre></div>
</div>
<p>etc.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Objects in <code class="docutils literal notranslate"><span class="pre">py2store.utils.attr_dict</span></code> module</p>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.Attrs">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">Attrs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_filt=&lt;function</span> <span class="pre">not_underscore_prefixed&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">getattrs=&lt;built-in</span> <span class="pre">function</span> <span class="pre">dir&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#Attrs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.Attrs" title="Link to this definition"></a></dt>
<dd><p>A simple recursive KvReader for the attributes of a python object.
Keys are attr names, values are Attrs(attr_val) instances.</p>
<p>Note: A more significant version of Attrs, along with many tools based on it,
was moved to pypi package: guide.</p>
<blockquote>
<div><p>pip install guide</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="dol.sources.Attrs.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="n"><span class="pre">E</span></span></em>, <span class="optional">]</span><em class="sig-param"><span class="n"><span class="pre">**F</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None.</span>&#160; <span class="pre">Update</span> <span class="pre">D</span> <span class="pre">from</span> <span class="pre">mapping/iterable</span> <span class="pre">E</span> <span class="pre">and</span> <span class="pre">F.</span></span></span><a class="headerlink" href="#dol.sources.Attrs.update" title="Link to this definition"></a></dt>
<dd><p>If E present and has a .keys() method, does:     for k in E: D[k] = E[k]
If E present and lacks .keys() method, does:     for (k, v) in E: D[k] = v
In either case, this is followed by: for k, v in F.items(): D[k] = v</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dol.sources.Attrs.update_keys_cache">
<span class="sig-name descname"><span class="pre">update_keys_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dol.sources.Attrs.update_keys_cache" title="Link to this definition"></a></dt>
<dd><p>Updates the _keys_cache by calling its {} method</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.CachedKeysSequenceKvReader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">CachedKeysSequenceKvReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sequence:</span> <span class="pre">~typing.Iterable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key:</span> <span class="pre">~typing.Callable</span> <span class="pre">|</span> <span class="pre">~typing.Iterable[str</span> <span class="pre">|</span> <span class="pre">int]</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val:</span> <span class="pre">~typing.Callable</span> <span class="pre">|</span> <span class="pre">~typing.Iterable[str</span> <span class="pre">|</span> <span class="pre">int]</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_postproc=&lt;class</span> <span class="pre">'list'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#CachedKeysSequenceKvReader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.CachedKeysSequenceKvReader" title="Link to this definition"></a></dt>
<dd><p>SequenceKvReader but with keys cached. Use this one if you will perform multiple
accesses to only some of the keys of the store</p>
<dl class="py method">
<dt class="sig sig-object py" id="dol.sources.CachedKeysSequenceKvReader.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><span class="optional">[</span><em class="sig-param"><span class="n"><span class="pre">E</span></span></em>, <span class="optional">]</span><em class="sig-param"><span class="n"><span class="pre">**F</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">None.</span>&#160; <span class="pre">Update</span> <span class="pre">D</span> <span class="pre">from</span> <span class="pre">mapping/iterable</span> <span class="pre">E</span> <span class="pre">and</span> <span class="pre">F.</span></span></span><a class="headerlink" href="#dol.sources.CachedKeysSequenceKvReader.update" title="Link to this definition"></a></dt>
<dd><p>If E present and has a .keys() method, does:     for k in E: D[k] = E[k]
If E present and lacks .keys() method, does:     for (k, v) in E: D[k] = v
In either case, this is followed by: for k, v in F.items(): D[k] = v</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="dol.sources.CachedKeysSequenceKvReader.update_keys_cache">
<span class="sig-name descname"><span class="pre">update_keys_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dol.sources.CachedKeysSequenceKvReader.update_keys_cache" title="Link to this definition"></a></dt>
<dd><p>Updates the _keys_cache by deleting the attribute</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.CachedSequenceKvReader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">CachedSequenceKvReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">key:</span> <span class="pre">~typing.Callable</span> <span class="pre">|</span> <span class="pre">~typing.Iterable[str</span> <span class="pre">|</span> <span class="pre">int]</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val:</span> <span class="pre">~typing.Callable</span> <span class="pre">|</span> <span class="pre">~typing.Iterable[str</span> <span class="pre">|</span> <span class="pre">int]</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_postproc=&lt;class</span> <span class="pre">'list'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#CachedSequenceKvReader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.CachedSequenceKvReader" title="Link to this definition"></a></dt>
<dd><p>SequenceKvReader but with the whole mapping cached as a dict. Use this one if
you will perform multiple accesses to the store</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="dol.sources.Ddir">
<span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">Ddir</span></span><a class="headerlink" href="#dol.sources.Ddir" title="Link to this definition"></a></dt>
<dd><p>alias of <a class="reference internal" href="#dol.sources.Attrs" title="dol.sources.Attrs"><code class="xref py py-class docutils literal notranslate"><span class="pre">Attrs</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.FanoutPersister">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">FanoutPersister</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Mapping</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_existing_values_only</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">need_to_set_all_stores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ignore_non_existing_store_keys</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#FanoutPersister"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.FanoutPersister" title="Link to this definition"></a></dt>
<dd><p>A fanout persister is a fanout reader that can also set and delete items.</p>
<p>param stores: A mapping of store keys to stores.
param default: The value to return if the key is not in any of the stores.
param get_existing_values_only: If True, only return values for stores that contain</p>
<blockquote>
<div><p>the key.</p>
</div></blockquote>
<dl class="simple">
<dt>param need_to_set_all_stores: If True, all stores must be set when setting a value.</dt><dd><p>If False, only the stores that are set will be updated.</p>
</dd>
<dt>param ignore_non_existing_store_keys: If True, ignore store keys from the value that</dt><dd><p>are not in the persister. If False, a ValueError is raised.</p>
</dd>
</dl>
<p>Let’s create a persister from in-memory stores:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bytes_store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata_store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span> <span class="o">=</span> <span class="n">FanoutPersister</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stores</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="n">bytes_store</span><span class="p">,</span> <span class="n">metadata_store</span><span class="o">=</span><span class="n">metadata_store</span><span class="p">)</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>The persister sets the values in each store, based on the store key in the value dict.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">metadata_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="go">{&#39;bytes_store&#39;: b&#39;a&#39;, &#39;metadata_store&#39;: {&#39;x&#39;: 1}}</span>
</pre></div>
</div>
<p>By default, not all stores must be set when setting a value:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">{&#39;bytes_store&#39;: b&#39;b&#39;, &#39;metadata_store&#39;: None}</span>
</pre></div>
</div>
<p>This allow to update a subset of the stores whithout having to set all the stores.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;A&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="go">{&#39;bytes_store&#39;: b&#39;A&#39;, &#39;metadata_store&#39;: {&#39;x&#39;: 1}}</span>
</pre></div>
</div>
<p>This behavior can be changed by passing <cite>need_to_set_all_stores=True</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">persister_all_stores</span> <span class="o">=</span> <span class="n">FanoutPersister</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stores</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">metadata_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">()),</span>
<span class="gp">... </span>    <span class="n">need_to_set_all_stores</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">persister_all_stores</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="o">...</span>
<span class="gr">ValueError</span>: <span class="n">All stores must be set when setting a value. Missing stores: {&#39;metadata_store&#39;}</span>
</pre></div>
</div>
<p>By default, if a store key from the value is not in the persister, a ValueError is
raised:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">bytes_store</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">metadata_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">other_store</span><span class="o">=</span><span class="s1">&#39;some value&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="o">...</span>
<span class="gr">ValueError</span>: <span class="n">The value contains some invalid store keys: {&#39;other_store&#39;}</span>
</pre></div>
</div>
<p>This behavior can be changed by passing <cite>ignore_non_existing_store_keys=True</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">persister_ignore_non_existing_store_keys</span> <span class="o">=</span> <span class="n">FanoutPersister</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stores</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span> <span class="n">metadata_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">()),</span>
<span class="gp">... </span>    <span class="n">ignore_non_existing_store_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">persister_ignore_non_existing_store_keys</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">bytes_store</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">metadata_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">other_store</span><span class="o">=</span><span class="s1">&#39;some value&#39;</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">persister_ignore_non_existing_store_keys</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="go">{&#39;bytes_store&#39;: b&#39;a&#39;, &#39;metadata_store&#39;: {&#39;y&#39;: 1}}</span>
</pre></div>
</div>
<p>Note that the value of the non-existing store key is ignored! So, be careful when
using this option, to avoid losing data.</p>
<p>Let’s delete items now:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">persister</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">persister</span>
<span class="go">False</span>
</pre></div>
</div>
<p>The key as been deleted from all the stores:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">bytes_store</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">metadata_store</span>
<span class="go">False</span>
</pre></div>
</div>
<p>As expected, if the key is not in any of the stores, a KeyError is raised:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">persister</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="o">...</span>
<span class="gr">KeyError</span>: <span class="n">&#39;z&#39;</span>
</pre></div>
</div>
<p>However, if the key is in some of the stores, but not in others, the key is deleted
from the stores where it is present:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bytes_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">persister</span> <span class="o">=</span> <span class="n">FanoutPersister</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stores</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="n">bytes_store</span><span class="p">,</span> <span class="n">metadata_store</span><span class="o">=</span><span class="nb">dict</span><span class="p">()),</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">persister</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">persister</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="n">bytes_store</span>
<span class="go">False</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.FanoutReader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">FanoutReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stores</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">Any</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Mapping</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">default</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">None</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_existing_values_only</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#FanoutReader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.FanoutReader" title="Link to this definition"></a></dt>
<dd><p>Get a ‘fanout view’ of a store of stores.
That is, when a key is requested, the key is passed to all the stores, and results
accumulated in a dict that is then returned.</p>
<p>param stores: A mapping of store keys to stores.
param default: The value to return if the key is not in any of the stores.
param get_existing_values_only: If True, only return values for stores that contain</p>
<blockquote>
<div><p>the key.</p>
</div></blockquote>
<p>Let’s define the following sub-stores:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bytes_store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">a</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">b</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;c&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata_store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">b</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>We can create a fan-out reader from these stores:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">stores</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bytes_store</span><span class="o">=</span><span class="n">bytes_store</span><span class="p">,</span> <span class="n">metadata_store</span><span class="o">=</span><span class="n">metadata_store</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">FanoutReader</span><span class="p">(</span><span class="n">stores</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">{&#39;bytes_store&#39;: b&#39;b&#39;, &#39;metadata_store&#39;: {&#39;x&#39;: 2}}</span>
</pre></div>
</div>
<p>The reader returns a dict with the values from each store, keyed by the name of the
store.</p>
<p>We can also pass a default value to return if the key is not in the store:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">FanoutReader</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stores</span><span class="o">=</span><span class="n">stores</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;no value in this store for this key&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="go">{&#39;bytes_store&#39;: b&#39;a&#39;, &#39;metadata_store&#39;: &#39;no value in this store for this key&#39;}</span>
</pre></div>
</div>
<p>If the key is not in any of the stores, a KeyError is raised:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="o">...</span>
<span class="gr">KeyError</span>: <span class="n">&#39;z&#39;</span>
</pre></div>
</div>
<p>We can also pass <cite>get_existing_values_only=True</cite> to only return values for stores
that contain the key:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">FanoutReader</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stores</span><span class="o">=</span><span class="n">stores</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">get_existing_values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="go">{&#39;bytes_store&#39;: b&#39;a&#39;}</span>
</pre></div>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="dol.sources.FanoutReader.from_variadics">
<em class="property"><span class="pre">classmethod</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_variadics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#FanoutReader.from_variadics"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.FanoutReader.from_variadics" title="Link to this definition"></a></dt>
<dd><p>A way to create a fan-out store from a mix of args and kwargs, instead of a
single dict.</p>
<dl class="simple">
<dt>param args: sub-stores used to fan-out the data. These stores will be</dt><dd><p>represented by their index in the tuple.</p>
</dd>
<dt>param kwargs: sub-stores used to fan-out the data. These stores will be</dt><dd><p>represented by their name in the dict. __init__ arguments can also be passed
as kwargs (i.e. <cite>default</cite>, <cite>get_existing_values_only</cite>, and any other subclass
specific arguments).</p>
</dd>
</dl>
<p>Let’s use the same sub-stores:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bytes_store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">a</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;a&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">b</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">=</span><span class="sa">b</span><span class="s1">&#39;c&#39;</span><span class="p">,</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">metadata_store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">b</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">c</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
<span class="gp">... </span>    <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
<span class="gp">... </span><span class="p">)</span>
</pre></div>
</div>
<p>We can create a fan-out reader from these stores, using args:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">FanoutReader</span><span class="o">.</span><span class="n">from_variadics</span><span class="p">(</span><span class="n">bytes_store</span><span class="p">,</span> <span class="n">metadata_store</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">{0: b&#39;b&#39;, 1: {&#39;x&#39;: 2}}</span>
</pre></div>
</div>
<p>The reader returns a dict with the values from each store, keyed by the index of
the store in the <cite>args</cite> tuple.</p>
<p>We can also create a fan-out reader passing the stores in kwargs:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">FanoutReader</span><span class="o">.</span><span class="n">from_variadics</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">bytes_store</span><span class="o">=</span><span class="n">bytes_store</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">metadata_store</span><span class="o">=</span><span class="n">metadata_store</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">{&#39;bytes_store&#39;: b&#39;b&#39;, &#39;metadata_store&#39;: {&#39;x&#39;: 2}}</span>
</pre></div>
</div>
<p>This way, the returned value is keyed by the name of the store.</p>
<p>We can also mix args and kwargs:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span> <span class="o">=</span> <span class="n">FanoutReader</span><span class="o">.</span><span class="n">from_variadics</span><span class="p">(</span><span class="n">bytes_store</span><span class="p">,</span> <span class="n">metadata_store</span><span class="o">=</span><span class="n">metadata_store</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reader</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">{0: b&#39;b&#39;, &#39;metadata_store&#39;: {&#39;x&#39;: 2}}</span>
</pre></div>
</div>
<p>Note that the order of the stores is determined by the order of the args and
kwargs.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.FlatReader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">FlatReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">readers</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#FlatReader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.FlatReader" title="Link to this definition"></a></dt>
<dd><p>Get a ‘flat view’ of a store of stores.
That is, where keys are <cite>(first_level_key, second_level_key)</cite> pairs.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">readers</span> <span class="o">=</span> <span class="p">{</span>
<span class="gp">... </span>    <span class="s1">&#39;fr&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;un&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;deux&#39;</span><span class="p">},</span>
<span class="gp">... </span>    <span class="s1">&#39;it&#39;</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;uno&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;due&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;tre&#39;</span><span class="p">},</span>
<span class="gp">... </span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">FlatReader</span><span class="p">(</span><span class="n">readers</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[(&#39;fr&#39;, 1), (&#39;fr&#39;, 2), (&#39;it&#39;, 1), (&#39;it&#39;, 2), (&#39;it&#39;, 3)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[(</span><span class="s1">&#39;fr&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
<span class="go">&#39;un&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="go">&#39;due&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.FuncDag">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">FuncDag</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">funcs</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#FuncDag"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.FuncDag" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.FuncReader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">FuncReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">funcs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Mapping</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#FuncReader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.FuncReader" title="Link to this definition"></a></dt>
<dd><p>Reader that seeds itself from a data fetching function list
Uses the function list names as the keys, and their returned value as the values.</p>
<p>For example: You have a list of urls that contain the data you want to have access
to.
You can write functions that bare the names you want to give to each dataset,
and have the function fetch the data from the url, extract the data from the
response and possibly prepare it (we advise minimally, since you can always
transform from the raw source, but the opposite can be impossible).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="s1">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">pi</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="mf">3.14159</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">FuncReader</span><span class="p">([</span><span class="n">foo</span><span class="p">,</span> <span class="n">pi</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;foo&#39;, &#39;pi&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
<span class="go">3.14159</span>
</pre></div>
</div>
<p>You might want to give your own names to the functions.
You might even have to (because the callable you’re using doesn’t have a <cite>__name__</cite>).
In that case, you can specify a <code class="docutils literal notranslate"><span class="pre">{name:</span> <span class="pre">func,</span> <span class="pre">...}</span></code> dict instead of a simple
iterable.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">FuncReader</span><span class="p">({</span><span class="s1">&#39;FU&#39;</span><span class="p">:</span> <span class="n">foo</span><span class="p">,</span> <span class="s1">&#39;Pie&#39;</span><span class="p">:</span> <span class="n">pi</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;FU&#39;, &#39;Pie&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;FU&#39;</span><span class="p">]</span>
<span class="go">&#39;bar&#39;</span>
</pre></div>
</div>
</dd></dl>

<dl class="py exception">
<dt class="sig sig-object py" id="dol.sources.NotUnique">
<em class="property"><span class="pre">exception</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">NotUnique</span></span><a class="reference internal" href="../../_modules/dol/sources.html#NotUnique"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.NotUnique" title="Link to this definition"></a></dt>
<dd><p>Raised when an iterator was expected to have only one element, but had more</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.ObjReader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">ObjReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">_obj_of_key</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#ObjReader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.ObjReader" title="Link to this definition"></a></dt>
<dd><p>A reader that uses a specified function to get the contents for a given key.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># define a contents_of_key that reads stuff from a dict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="mi">42</span><span class="p">:</span> <span class="s2">&quot;everything&quot;</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">read_dict</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span> <span class="o">=</span> <span class="n">ObjReader</span><span class="p">(</span><span class="n">_obj_of_key</span><span class="o">=</span><span class="n">read_dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span>
<span class="go">&#39;bar&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span><span class="p">[</span><span class="mi">42</span><span class="p">]</span>
<span class="go">&#39;everything&#39;</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># define contents_of_key that reads stuff from a file given it&#39;s path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pr</span> <span class="o">=</span> <span class="n">ObjReader</span><span class="p">(</span><span class="n">_obj_of_key</span><span class="o">=</span><span class="n">read_file</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_where_this_code_is</span> <span class="o">=</span> <span class="vm">__file__</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">file_where_this_code_is</span></code> should be the file where this doctest is written,
therefore should contain what I just said:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;therefore should contain what I just said&#39;</span> <span class="ow">in</span> <span class="n">pr</span><span class="p">[</span><span class="n">file_where_this_code_is</span><span class="p">]</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.sources.SequenceKvReader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.sources.</span></span><span class="sig-name descname"><span class="pre">SequenceKvReader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sequence:</span> <span class="pre">~typing.Iterable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key:</span> <span class="pre">~typing.Callable</span> <span class="pre">|</span> <span class="pre">~typing.Iterable[str</span> <span class="pre">|</span> <span class="pre">int]</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val:</span> <span class="pre">~typing.Callable</span> <span class="pre">|</span> <span class="pre">~typing.Iterable[str</span> <span class="pre">|</span> <span class="pre">int]</span> <span class="pre">|</span> <span class="pre">str</span> <span class="pre">|</span> <span class="pre">int</span> <span class="pre">|</span> <span class="pre">None</span> <span class="pre">=</span> <span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_postproc=&lt;class</span> <span class="pre">'list'&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/sources.html#SequenceKvReader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.sources.SequenceKvReader" title="Link to this definition"></a></dt>
<dd><p>A KvReader that sources itself in an iterable of elements from which keys and values
will be extracted and grouped by key.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">docs</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<span class="gp">... </span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="gp">... </span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}]</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Out of the box, SequenceKvReader gives you enumerated integer indices as keys,
and the sequence items as is, as vals</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[0, 1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="go">{&#39;_id&#39;: 1, &#39;s&#39;: &#39;b&#39;, &#39;n&#39;: 2}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;not_a_key&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
</pre></div>
</div>
<p>You can make it more interesting by specifying a val function to compute the vals
from the sequence elements</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;_id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># as before</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="go">[&#39;a&#39;, &#39;bbb&#39;, &#39;bbbbb&#39;]</span>
</pre></div>
</div>
<p>But where it becomes more useful is when you specify a key as well.
SequenceKvReader will then compute the keys with that function, group them,
and return as the value, the list of sequence elements that match that key.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span>
<span class="gp">... </span>        <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">],</span>
<span class="gp">... </span>        <span class="n">val</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">-</span> <span class="p">{</span><span class="s1">&#39;s&#39;</span><span class="p">}})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}]</span>
</pre></div>
</div>
<p>The cannonical form of key and val is a function, but if you specify a str, int,
or iterable thereof,
SequenceKvReader will make an itemgetter function from it, for your convenience.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;_id&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">[{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">val_postproc</span></code> argument is <code class="docutils literal notranslate"><span class="pre">list</span></code> by default, but what if we don’t specify
any?
Well then you’ll get an unconsumed iterable of matches</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span> <span class="n">val_postproc</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">val_postproc</span></code> argument specifies what to apply to this iterable of matches.
For example, you can specify <code class="docutils literal notranslate"><span class="pre">val_postproc=next</span></code> to simply get the first matched
element:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span> <span class="n">val_postproc</span><span class="o">=</span><span class="nb">next</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>
</div>
<p>We got the whole dict there. What if we just want we didn’t want the _id, which is
used by the key, in our val?</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">all_but_s</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exclusive_subdict</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">all_but_s</span><span class="p">,</span> <span class="n">val_postproc</span><span class="o">=</span><span class="nb">next</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>
</div>
<p>Suppose we want to have the pair of (‘_id’, ‘n’) values as a key, and only ‘s’
as a value…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;_id&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">),</span> <span class="n">val</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">val_postproc</span><span class="o">=</span><span class="nb">next</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span>
</pre></div>
</div>
<p>But remember that using <code class="docutils literal notranslate"><span class="pre">val_postproc=next</span></code> will only give you the first match
as a val.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">all_but_s</span><span class="p">,</span> <span class="n">val_postproc</span><span class="o">=</span><span class="nb">next</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>   <span class="c1"># note that only the first match is returned.</span>
</pre></div>
</div>
<p>If you do want to only grab the first match, but want to additionally assert
that there is no more than one,
you can specify this with <code class="docutils literal notranslate"><span class="pre">val_postproc=unique_element</span></code>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceKvReader</span><span class="p">(</span><span class="n">docs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">all_but_s</span><span class="p">,</span> <span class="n">val_postproc</span><span class="o">=</span><span class="n">unique_element</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The following should raise an exception since there&#39;s more than one match</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>  
<span class="gt">Traceback (most recent call last):</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">sources.NotUnique</span>: <span class="n">iterator had more than one element</span>
</pre></div>
</div>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="signatures.html" class="btn btn-neutral float-left" title="dol.signatures" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tests/base_test.html" class="btn btn-neutral float-right" title="dol.tests.base_test" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>