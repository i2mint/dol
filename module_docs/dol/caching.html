

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dol.caching &mdash; dol 0.3.10 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=9f76a604"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/toggleprompt.js?v=d7ede5d2"></script>
      <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="dol.dig" href="dig.html" />
    <link rel="prev" title="dol.base" href="base.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            dol
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../dol.html">dol</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendable.html">dol.appendable</a></li>
<li class="toctree-l1"><a class="reference internal" href="base.html">dol.base</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">dol.caching</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.HashableDict"><code class="docutils literal notranslate"><span class="pre">HashableDict</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.WriteBackChainMap"><code class="docutils literal notranslate"><span class="pre">WriteBackChainMap</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.cache_vals"><code class="docutils literal notranslate"><span class="pre">cache_vals()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.get_cache"><code class="docutils literal notranslate"><span class="pre">get_cache()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.mk_cached_store"><code class="docutils literal notranslate"><span class="pre">mk_cached_store()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.mk_memoizer"><code class="docutils literal notranslate"><span class="pre">mk_memoizer()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.mk_sourced_store"><code class="docutils literal notranslate"><span class="pre">mk_sourced_store()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.mk_write_cached_store"><code class="docutils literal notranslate"><span class="pre">mk_write_cached_store()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.store_cached"><code class="docutils literal notranslate"><span class="pre">store_cached()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#dol.caching.store_cached_with_single_key"><code class="docutils literal notranslate"><span class="pre">store_cached_with_single_key()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dig.html">dol.dig</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">dol.errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="explicit.html">dol.explicit</a></li>
<li class="toctree-l1"><a class="reference internal" href="filesys.html">dol.filesys</a></li>
<li class="toctree-l1"><a class="reference internal" href="kv_codecs.html">dol.kv_codecs</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">dol.misc</a></li>
<li class="toctree-l1"><a class="reference internal" href="mixins.html">dol.mixins</a></li>
<li class="toctree-l1"><a class="reference internal" href="naming.html">dol.naming</a></li>
<li class="toctree-l1"><a class="reference internal" href="paths.html">dol.paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="recipes.html">dol.recipes</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap.html">dol.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/new_store_wrap.html">dol.scrap.new_store_wrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="scrap/store_factories.html">dol.scrap.store_factories</a></li>
<li class="toctree-l1"><a class="reference internal" href="signatures.html">dol.signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="sources.html">dol.sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/base_test.html">dol.tests.base_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/pickability_test.html">dol.tests.pickability_test</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/scrap.html">dol.tests.scrap</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_appendable.html">dol.tests.test_appendable</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_dol_tools.html">dol.tests.test_dol_tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_edge_cases.html">dol.tests.test_edge_cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_fanout_stores.html">dol.tests.test_fanout_stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_filesys.html">dol.tests.test_filesys</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_kv_codecs.html">dol.tests.test_kv_codecs</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_paths.html">dol.tests.test_paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/test_trans.html">dol.tests.test_trans</a></li>
<li class="toctree-l1"><a class="reference internal" href="tests/utils_for_tests.html">dol.tests.utils_for_tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="tools.html">dol.tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="trans.html">dol.trans</a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html">dol.util</a></li>
<li class="toctree-l1"><a class="reference internal" href="zipfiledol.html">dol.zipfiledol</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dol</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">dol.caching</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/module_docs/dol/caching.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-dol.caching">
<span id="dol-caching"></span><h1>dol.caching<a class="headerlink" href="#module-dol.caching" title="Link to this heading"></a></h1>
<p>Tools to add caching layers to stores.</p>
<dl class="py class">
<dt class="sig sig-object py" id="dol.caching.HashableDict">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">HashableDict</span></span><a class="reference internal" href="../../_modules/dol/caching.html#HashableDict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.HashableDict" title="Link to this definition"></a></dt>
<dd><p>Just a dict, but hashable</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="dol.caching.WriteBackChainMap">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">WriteBackChainMap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">maps</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/caching.html#WriteBackChainMap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.WriteBackChainMap" title="Link to this definition"></a></dt>
<dd><p>A collections.ChainMap that also ‘writes back’ when a key is found.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">dol.caching</span><span class="w"> </span><span class="kn">import</span> <span class="n">WriteBackChainMap</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">WriteBackChainMap</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">33</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="mi">444</span><span class="p">})</span>
</pre></div>
</div>
<p>In a <code class="docutils literal notranslate"><span class="pre">ChainMap</span></code>, when you ask for the value for a key, each mapping in the
sequence is checked for, and the first mapping found that contains it will be
the one determining the value.</p>
<p>So here if you look for <cite>b</cite>, though the first mapping will give you the value,
though the second mapping also contains a <cite>b</cite> with a different value:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="go">2</span>
</pre></div>
</div>
<p>if you ask for <cite>c</cite>, it’s the second mapping that will give you the value:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="go">33</span>
</pre></div>
</div>
<p>But unlike with the builtin <code class="docutils literal notranslate"><span class="pre">ChainMap</span></code>, something else is going to happen here:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">WriteBackChainMap({&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 33}, {&#39;b&#39;: 22, &#39;c&#39;: 33}, {&#39;d&#39;: 444})</span>
</pre></div>
</div>
<p>See that now the first mapping also has the <code class="docutils literal notranslate"><span class="pre">('c',</span> <span class="pre">33)</span></code> key-value pair:</p>
<p>That is what we call “write back”.</p>
<p>When a key is found in a mapping, all previous mappings (which by definition of
<code class="docutils literal notranslate"><span class="pre">ChainMap</span></code> did not have a value for that key) will be revisited and that key-value
pair will be written in it.</p>
<p>As in with <code class="docutils literal notranslate"><span class="pre">ChainMap</span></code>, all writes will be carried out in the first mapping,
and only the first mapping:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">WriteBackChainMap({&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;c&#39;: 33, &#39;e&#39;: 5}, {&#39;b&#39;: 22, &#39;c&#39;: 33}, {&#39;d&#39;: 444})</span>
</pre></div>
</div>
<p>Example use cases:</p>
<ul class="simple">
<li><p>You’re working with a local and a remote source of data. You’d like to list the</p></li>
</ul>
<p>keys available in both, and use the local item if it’s available, and if it’s not,
you want it to be sourced from remote, but written in local for quicker access
next time.</p>
<ul class="simple">
<li><p>You have several sources to look for configuration values: a sequence of</p></li>
</ul>
<p>configuration files/folders to look through (like a unix search path for command
resolution) and environment variables.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dol.caching.cache_vals">
<span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">cache_vals</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">store=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache=&lt;class</span> <span class="pre">'dict'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__module__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__name__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__qualname__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__doc__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__annotations__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__defaults__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__kwdefaults__=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/caching.html#cache_vals"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.cache_vals" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The class of the store you want to cache</p></li>
<li><p><strong>cache</strong> – The store you want to use to cache. Anything with a __setitem__(k, v) and a __getitem__(k).
By default, it will use a dict</p></li>
</ul>
</dd>
</dl>
<p>Returns: A subclass of the input store, but with caching (to the cache store)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">dol.caching</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache_vals</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">SlowDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">sleep_s</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_s</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">SlowDict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>  <span class="c1"># Wow! Takes a long time to get &#39;a&#39;</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CachedSlowDict</span> <span class="o">=</span> <span class="n">cache_vals</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">SlowDict</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">CachedSlowDict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: []</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This will take a LONG time because it&#39;s the first time we ask for &#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This will take very little time because we have &#39;a&#39; in the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But we don&#39;t have &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But now we have &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># and we can do things normally (like put stuff in the store)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>  <span class="c1"># if we ask for it again though, it will take time (the first time)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;, &#39;d&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Of course, we could write &#39;d&#39; in the cache as well, to get it quicker,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but that&#39;s another story: The story of write caches!</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And by the way, your &quot;cache wrapped&quot; store hold a pointer to the cache it&#39;s using,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># so you can take a peep there if needed:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_cache</span>
<span class="go">{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;d&#39;: 4}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dol.caching.get_cache">
<span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">get_cache</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/caching.html#get_cache"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.get_cache" title="Link to this definition"></a></dt>
<dd><p>Convenience function to get a cache (whether it’s already an instance, or needs to be validated)</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dol.caching.mk_cached_store">
<span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">mk_cached_store</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">store=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache=&lt;class</span> <span class="pre">'dict'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__module__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__name__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__qualname__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__doc__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__annotations__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__defaults__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__kwdefaults__=None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#dol.caching.mk_cached_store" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The class of the store you want to cache</p></li>
<li><p><strong>cache</strong> – The store you want to use to cache. Anything with a __setitem__(k, v) and a __getitem__(k).
By default, it will use a dict</p></li>
</ul>
</dd>
</dl>
<p>Returns: A subclass of the input store, but with caching (to the cache store)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">dol.caching</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache_vals</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">SlowDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">sleep_s</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sleep_s</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">SlowDict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>  <span class="c1"># Wow! Takes a long time to get &#39;a&#39;</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">CachedSlowDict</span> <span class="o">=</span> <span class="n">cache_vals</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">SlowDict</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="n">cache</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">CachedSlowDict</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: []</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This will take a LONG time because it&#39;s the first time we ask for &#39;a&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># This will take very little time because we have &#39;a&#39; in the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But we don&#39;t have &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But now we have &#39;b&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">v</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># and we can do things normally (like put stuff in the store)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>  <span class="c1"># if we ask for it again though, it will take time (the first time)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">cache: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="go">store: [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;]</span>
<span class="go">cache: [&#39;a&#39;, &#39;b&#39;, &#39;d&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Of course, we could write &#39;d&#39; in the cache as well, to get it quicker,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># but that&#39;s another story: The story of write caches!</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># And by the way, your &quot;cache wrapped&quot; store hold a pointer to the cache it&#39;s using,</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># so you can take a peep there if needed:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">_cache</span>
<span class="go">{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;d&#39;: 4}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dol.caching.mk_memoizer">
<span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">mk_memoizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cache</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/caching.html#mk_memoizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.mk_memoizer" title="Link to this definition"></a></dt>
<dd><p>Make a memoizer that caches the output of a getter function in a cache.</p>
<p>Note: This is a specialized memoizer for getter functions/methods, i.e.
functions/methods that have the signature (instance, key) and return a value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cache</strong> – The cache to use. Must have __getitem__ and __setitem__ methods.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A memoizer that caches the output of the function in the cache.</p>
</dd>
</dl>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">cache</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@mk_memoizer</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">getter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;getting value for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">10</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">getting value for 2...</span>
<span class="go">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="go">20</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dol.caching.mk_sourced_store">
<span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">mk_sourced_store</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">store</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">source</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_source_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__module__</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__name__</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__qualname__</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__doc__</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__annotations__</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__defaults__</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__kwdefaults__</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/caching.html#mk_sourced_store"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.mk_sourced_store" title="Link to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The class of the store you want to cache</p></li>
<li><p><strong>cache</strong> – The store you want to use to cache. Anything with a __setitem__(k, v) and a __getitem__(k).
By default, it will use a dict</p></li>
<li><p><strong>return_source_data</strong></p></li>
</ul>
</dd>
</dl>
<p>Returns: A subclass of the input store, but with caching (to the cache store)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The class of the store you’re talking to. This store acts as the cache</p></li>
<li><p><strong>source</strong> – The store that is used to populate the store (cache) when a key is missing there.</p></li>
<li><p><strong>return_source_data</strong> – If True, will return <code class="docutils literal notranslate"><span class="pre">source[k]</span></code> as is. This should be used only if <code class="docutils literal notranslate"><span class="pre">store[k]</span></code> would return the same.
If False, will first write to cache (<code class="docutils literal notranslate"><span class="pre">store[k]</span> <span class="pre">=</span> <span class="pre">source[k]</span></code>) then return <code class="docutils literal notranslate"><span class="pre">store[k]</span></code>.
The latter introduces a performance hit (we write and then read again from the cache),
but ensures consistency (and is useful if the writing or the reading to/from store
transforms the data in some way.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A decorated store</p>
</dd>
</dl>
<p>Here are two stores pretending to be local and remote data stores respectively.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">dol.caching</span><span class="w"> </span><span class="kn">import</span> <span class="n">mk_sourced_store</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Local</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;looking for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> in Local&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">Remote</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;looking for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> in Remote&quot;</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s make a remote store with two elements in it, and a local store class that asks the remote store for stuff
if it can’t find it locally.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">remote</span> <span class="o">=</span> <span class="n">Remote</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="s1">&#39;world&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SourcedLocal</span> <span class="o">=</span> <span class="n">mk_sourced_store</span><span class="p">(</span><span class="n">Local</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">remote</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SourcedLocal</span><span class="p">({</span><span class="s1">&#39;some&#39;</span><span class="p">:</span> <span class="s1">&#39;local stuff&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># the local store has one key</span>
<span class="go">[&#39;some&#39;]</span>
</pre></div>
</div>
<p># but if we ask for a key that is in the remote store, it provides it</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span>
<span class="go">looking for foo in Local</span>
<span class="go">looking for foo in Remote</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;some&#39;, &#39;foo&#39;]</span>
</pre></div>
</div>
<p>See that next time we ask for the ‘foo’ key, the local store provides it:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span>
<span class="go">looking for foo in Local</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">s</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;world&#39;</span>
<span class="go">looking for hello in Local</span>
<span class="go">looking for hello in Remote</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;some&#39;, &#39;foo&#39;, &#39;hello&#39;]</span>
</pre></div>
</div>
<p>We can still add stuff (locally)…</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;something&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;else&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">[&#39;some&#39;, &#39;foo&#39;, &#39;hello&#39;, &#39;something&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dol.caching.mk_write_cached_store">
<span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">mk_write_cached_store</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">store=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">w_cache=&lt;class</span> <span class="pre">'dict'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">flush_cache_condition=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__module__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__name__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__qualname__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__doc__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__annotations__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__defaults__=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">__kwdefaults__=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/caching.html#mk_write_cached_store"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.mk_write_cached_store" title="Link to this definition"></a></dt>
<dd><p>Wrap a write cache around a store.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>w_cache</strong> – The store to (write) cache to</p></li>
<li><p><strong>flush_cache_condition</strong> – The condition to apply to the cache
to decide whether it’s contents should be flushed or not</p></li>
</ul>
</dd>
</dl>
<p>A <code class="docutils literal notranslate"><span class="pre">w_cache</span></code> must have a clear method (that clears the cache’s contents).
If you know what you’re doing and want to add one to your input kv store,
you can do so by calling <code class="docutils literal notranslate"><span class="pre">ensure_clear_to_kv_store(store)</span></code>
– this will add a <code class="docutils literal notranslate"><span class="pre">clear</span></code> method inplace AND return the resulting store as well.</p>
<p>We didn’t add this automatically because the first thing <code class="docutils literal notranslate"><span class="pre">mk_write_cached_store</span></code> will do is call clear,
to remove all the contents of the store.
You don’t want to do this unwittingly and delete a bunch of precious data!!</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">dol.caching</span><span class="w"> </span><span class="kn">import</span> <span class="n">mk_write_cached_store</span><span class="p">,</span> <span class="n">ensure_clear_to_kv_store</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">dol.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Store</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span><span class="w"> </span><span class="nf">print_state</span><span class="p">(</span><span class="n">store</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;store: </span><span class="si">{</span><span class="n">store</span><span class="si">}</span><span class="s2"> ----- store._w_cache: </span><span class="si">{</span><span class="n">store</span><span class="o">.</span><span class="n">_w_cache</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">MyStore</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span><span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{})</span>  <span class="c1"># wrap MyStore with a (dict) write cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">()</span>  <span class="c1"># make a MyCachedStore instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># print the contents (both store and cache), see that it&#39;s empty</span>
<span class="go">store: {} ----- store._w_cache: {}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;world&#39;</span>  <span class="c1"># write &#39;world&#39; in &#39;hello&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># see that it hasn&#39;t been written</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;ding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dong&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;, &#39;ding&#39;: &#39;dong&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">flush_cache</span><span class="p">()</span>  <span class="c1"># manually flush the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># note that store._w_cache is empty, but store has the data now</span>
<span class="go">store: {&#39;hello&#39;: &#39;world&#39;, &#39;ding&#39;: &#39;dong&#39;} ----- store._w_cache: {}</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># But you usually want to use the store as a context manager</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{},</span>
<span class="gp">... </span>    <span class="n">flush_cache_condition</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">the_persistent_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">(</span><span class="n">the_persistent_dict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Before writing data:&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">s</span><span class="p">[</span><span class="s1">&#39;hello&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;world&#39;</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; Before exiting the with block:&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">===&gt; Before writing data:</span>
<span class="go">store: {} ----- store._w_cache: {}</span>
<span class="go">===&gt; Before exiting the with block:</span>
<span class="go">store: {} ----- store._w_cache: {&#39;hello&#39;: &#39;world&#39;}</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===&gt; After exiting the with block:&quot;</span><span class="p">);</span> <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>  <span class="c1"># Note that the cache store flushed!</span>
<span class="go">===&gt; After exiting the with block:</span>
<span class="go">store: {&#39;hello&#39;: &#39;world&#39;} ----- store._w_cache: {}</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Example of auto-flushing when there&#39;s at least two elements</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span><span class="w"> </span><span class="nc">MyStore</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span> <span class="o">...</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">MyCachedStore</span> <span class="o">=</span> <span class="n">mk_write_cached_store</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">MyStore</span><span class="p">,</span> <span class="n">w_cache</span><span class="o">=</span><span class="p">{},</span>
<span class="gp">... </span>    <span class="n">flush_cache_condition</span><span class="o">=</span><span class="k">lambda</span> <span class="n">w_cache</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">w_cache</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">MyCachedStore</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">s</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
<span class="gp">... </span>        <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span>
<span class="gp">... </span>        <span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">store: {} ----- store._w_cache: {0: 0}</span>
<span class="go">store: {} ----- store._w_cache: {0: 0, 1: 10}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {3: 30}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20} ----- store._w_cache: {3: 30, 4: 40}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50} ----- store._w_cache: {}</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50} ----- store._w_cache: {6: 60}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># There was still something left in the cache before exiting the with block. But now...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">print_state</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="go">store: {0: 0, 1: 10, 2: 20, 3: 30, 4: 40, 5: 50, 6: 60} ----- store._w_cache: {}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dol.caching.store_cached">
<span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">store_cached</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">store</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key_func</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Callable</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/caching.html#store_cached"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.store_cached" title="Link to this definition"></a></dt>
<dd><p>Function output memorizer but using a specific (usually persisting) store as it’s
memory and a key_func to compute the key under which to store the output.</p>
<p>The key can be
- a single value under which the output should be stored, regardless of the input.
- a key function that is called on the inputs to create a hash under which the function’s output should be stored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The key-value store to use for caching. Must support __getitem__ and __setitem__.</p></li>
<li><p><strong>key_func</strong> – The key function that is called on the input of the function to create the key value.</p></li>
</ul>
</dd>
</dl>
<p>Note: Union[Callable, Any] is equivalent to just Any, but reveals the two cases of a key more clearly.
Note: No, Union[Callable, Hashable] is not better. For one, general store keys are not restricted to hashable keys.
Note: No, they shouldn’t.</p>
<p>See Also: store_cached_with_single_key (for a version where the cache store key doesn’t depend on function’s args)</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note: Our doc test will use dict as the store, but to make the functionality useful beyond existing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># RAM-memorizer, you should use actual &quot;persisting&quot; stores that store in local files, or DBs, etc.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@store_cached</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">args</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">my_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pretend this is a long computation&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># note the print below (because the function is called</span>
<span class="go">Pretend this is a long computation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># note there&#39;s no print (because the function is NOT called)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span> <span class="o">==</span> <span class="n">tt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  <span class="c1"># but different inputs will trigger the actual function again</span>
<span class="go">Pretend this is a long computation</span>
<span class="go">7</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="o">.</span><span class="n">_cache</span>
<span class="go">{(1, 2): 3, (3, 4): 7}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="dol.caching.store_cached_with_single_key">
<span class="sig-prename descclassname"><span class="pre">dol.caching.</span></span><span class="sig-name descname"><span class="pre">store_cached_with_single_key</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">store</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">key</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/dol/caching.html#store_cached_with_single_key"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#dol.caching.store_cached_with_single_key" title="Link to this definition"></a></dt>
<dd><p>Function output memorizer but using a specific store and key as its memory.</p>
<p>Use in situations where you have a argument-less function or bound method that computes some data whose dependencies
are static enough that there’s enough advantage to make the data refresh explicit (by deleting the cache entry)
instead of making it implicit (recomputing/refetching the data every time).</p>
<p>The key should be a single value under which the output should be stored, regardless of the input.</p>
<p>Note: The wrapped function comes with a empty_cache attribute, which when called, empties the cache (i.e. removes
the key from the store)</p>
<p>Note: The wrapped function has a hidden <cite>_cache</cite> attribute pointing to the store in case you need to peep into it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>store</strong> – The cache. The key-value store to use for caching. Must support __getitem__ and __setitem__.</p></li>
<li><p><strong>key</strong> – The store key under which to store the output of the function.</p></li>
</ul>
</dd>
</dl>
<p>Note: Union[Callable, Any] is equivalent to just Any, but reveals the two cases of a key more clearly.
Note: No, Union[Callable, Hashable] is not better. For one, general store keys are not restricted to hashable keys.
Note: No, they shouldn’t.</p>
<p>See Also: store_cached (for a version whose keys are computed from the wrapped function’s input.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Note: Our doc test will use dict as the store, but to make the functionality useful beyond existing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># RAM-memorizer, you should use actual &quot;persisting&quot; stores that store in local files, or DBs, etc.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">store</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nd">@store_cached_with_single_key</span><span class="p">(</span><span class="n">store</span><span class="p">,</span> <span class="s1">&#39;whatevs&#39;</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span><span class="w"> </span><span class="nf">my_data</span><span class="p">():</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pretend this is a long computation&quot;</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">()</span>  <span class="c1"># note the print below (because the function is called</span>
<span class="go">Pretend this is a long computation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">()</span>  <span class="c1"># note there&#39;s no print (because the function is NOT called)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">t</span> <span class="o">==</span> <span class="n">tt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tt</span>
<span class="go">[1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="o">.</span><span class="n">_cache</span>  <span class="c1"># peep in the cache</span>
<span class="go">{&#39;whatevs&#39;: [1, 2, 3]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># let&#39;s empty the cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">my_data</span><span class="o">.</span><span class="n">empty_cache_entry</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="s1">&#39;whatevs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">my_data</span><span class="o">.</span><span class="n">_cache</span>  <span class="c1"># see that the cache entry is gone.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span> <span class="o">=</span> <span class="n">my_data</span><span class="p">()</span>  <span class="c1"># so when you call the function again, it prints again!d</span>
<span class="go">Pretend this is a long computation</span>
</pre></div>
</div>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="base.html" class="btn btn-neutral float-left" title="dol.base" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dig.html" class="btn btn-neutral float-right" title="dol.dig" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright NO COPYRIGHT.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>